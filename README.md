# Получение изображения с камеры с помощью скрипта capture-image

## Установка The Imaging Source SDK
Скрипт ```capture-image``` использует утилиты из The Imaging Source (TIS) Linux SDK, поэтому для работы скрипта этот SDK нужно скомпилировать и установить. Инструкции по компиляции и установке TIS Linux SDK: https://github.com/TheImagingSource/tiscamera

## Получение серийного номера камеры

Прежде всего необходимо получить серийный номер подключенной камеры. Для этого используется утилита ```tcam-ctrl``` из TIS SDK . Следующая команда выводит список всех подключенных камер и их серийные номера.

```
tcam-ctrl -l
```

Более подробную информацию об этой утилите можно получить, запустив её без параметров.

## Получение снимка с камеры

Теперь можно получить снимок с помощью скрипта ```capture-image```. Следующая команда устанавливает значения яркости (brightness), усиления (gain) и экспозиции (exposure) и сохраняет снимок в файл.

```
capture-image -b 4 -g 35 -e 6800 <СЕРИЙНЫЙ_НОМЕР>
```

Следующая команда сохраняет снимок в файл, параметры настраиваются автоматически.

```
capture-image -A <СЕРИЙНЫЙ_НОМЕР>
```

**Примечание:** иногда после переподключения камеры автоматическая настройка её параметров не может быть произведена и скрипт завершается с ошибкой. В этом случае необходимо сначала запустить его с явным указанием яркости, усиления и экспозиции (см. Подробное описание).

## Подробное описание скрипта ```capture-image```

Использование: ```capture-image [-b <ЯРКОСТЬ>] [-g <УСИЛЕНИЕ>] [-A] [-S] [-v] <СЕРИЙНЫЙ_НОМЕР>```

Bash-скрипт ```capture-image``` позволяет получить снимок с камеры и сохранить его в файл. Имеется возможность регулирования параметров камеры (яркость, усиление, экспозиция), а также их автоматическая настройка. Также для подбора оптимальных параметров камеры предусмотрено получение видеопотока в реальном времени.
Используйте утилиту ```tcam-ctrl``` из TIS SDK, чтобы получить серийный номер камеры, список её параметров, диапазоны их значений и прочую информацию.

Когда значения параметров камеры изменяются, их новые значения сохраняются до следующего изменения, т.е. если при следующем запуске скрипта не указывать новые значения, будут использованы предыдущие.

```
capture-image <СЕРИЙНЫЙ_НОМЕР>
```

Если сохранённых значений параметров нет, и они не указаны явно, произойдет ошибка. Поэтому после переподключения камеры или перезагрузки системы рекомендуется сначала запустить скрипт с явным указанием яркости, усиления и экспозиции.

### Опции

* -b <значение>&nbsp;&nbsp;&nbsp;    устанавливает значение яркости
* -g <значение>&nbsp;&nbsp;&nbsp;    устанавливает значение усиления
* -e <значение>&nbsp;&nbsp;&nbsp;    устанавливает значение экспозиции
* -A &nbsp;&nbsp;&nbsp;    автоматическая коррекция усиления и экспозиции
* -S &nbsp;&nbsp;&nbsp;    вместо сохранения снимка в файл, начинает показ видеопотока в реальном времени. Удобно для настройки оптимальных значений параметров камеры
* -v &nbsp;&nbsp;&nbsp;    перед получением изображения выводит текущие значение параметров камеры. Это создает дополнительную задержку перед тем, как изображение будет получено

### Примеры использования

Установить значения параметров камеры (яркость=4, усиление=35, экспозиция=6800) и сохранить снимок в файл.

```
capture-image -b 4 -g 35 -e 6800 <СЕРИЙНЫЙ_НОМЕР>
```

Установить значение экспозиции, вывести текущие значения параметров камеры и сохранить снимок в файл. Для яркости и усиления будут использованы значения, использованные при предыдущем запуске скрипта.

```
capture-image -e 12000 -v <СЕРИЙНЫЙ_НОМЕР>
```

Сохранить снимок в файл, параметры настраиваются автоматически.

```
capture-image -A <СЕРИЙНЫЙ_НОМЕР>
```

Включить автоматическую настройку параметров и начать показ видеопотока с камеры в реальном времени.

```
capture-image -A -S <СЕРИЙНЫЙ_НОМЕР>
```

---

